<mvc:View
	controllerName="aisaas.ui.controller.EmailColumn"
	displayBlock="true"
	xmlns="sap.m"
	xmlns:mvc="sap.ui.core.mvc"
    xmlns:tnt="sap.tnt"
    xmlns:ux="sap.uxap"
	xmlns:core="sap.ui.core"
	core:require="{ formatter:
	'aisaas/ui/model/formatter' }">

    <ux:ObjectPageLayout id="emailPage" showAnchorBarPopover="false" upperCaseAnchorBar="false" headerContentPinned="true" visible="{= ${/activeEmailId} !== null }">
		<ux:headerTitle>
			<ux:ObjectPageDynamicHeaderTitle>
				<ux:heading>
					<VBox>
						<Title text="{= !${/translationActivated} ? ${api>mail/subject} : ${api>mail/translationSubject} }"/>
						<HBox>
							<Label vAlign="Middle" text="{path: 'api>mail/modifiedAt', formatter: 'formatter.formatDate'}"/>
							<ObjectStatus
								class="sapUiTinyMarginBegin"
								inverted="true"
								icon="sap-icon://high-priority"
								text="{parts: ['filters>/urgency', 'api>mail/urgency'], formatter:'formatter.getUrgencyText'}"
								state="{path:'api>mail/urgency', formatter:'formatter.getUrgencyState'}"/>
							<ObjectStatus
								class="sapUiTinyMarginBegin"
								inverted="true"
								icon="{path:'api>mail/sentiment', formatter:'formatter.getSentimentIcon'}"
								text="{parts: ['filters>/sentiment', 'api>mail/sentiment'], formatter:'formatter.getSentimentText'}"
								state="{path:'api>mail/sentiment', formatter:'formatter.getSentimentState'}"/>
							<tnt:InfoLabel
								class="sapUiTinyMarginBegin"
								displayOnly="true"
								text="{api>mail/category}"/>
						</HBox>
					</VBox>
				</ux:heading>
				<ux:actions>
					<Button text="{i18n>email.header.translationButton.translate}" press="onTranslate"/>
				</ux:actions>
			</ux:ObjectPageDynamicHeaderTitle>
		</ux:headerTitle>

		<ux:headerContent>
			<HBox wrap="Wrap" width="100%">
				<Avatar
					displaySize="L"
					backgroundColor="Accent6"
					initials="{path:'api>mail/sender', formatter:'formatter.getAvatarInitial'}"/>
				<VBox class="sapUiMediumMarginBegin">
					<Title text="{i18n>email.header.customerInformation}"/>
					<Text text="{api>mail/sender}"/>
				</VBox>
			</HBox>
		</ux:headerContent>

		<ux:sections>
			<ux:ObjectPageSection id="incomingMessageSection" titleUppercase="false" title="{i18n>email.tabs.label.incomingMessage}">
				<ux:subSections>
					<ux:ObjectPageSubSection title="{i18n>email.tabs.label.incomingMessage}">
						<VBox class="sapUiTinyMargin">
							<Text text="{= !${/translationActivated} ? ${api>mail/body} : ${api>mail/translationBody} }"/>
						</VBox>
					</ux:ObjectPageSubSection>
				</ux:subSections>
			</ux:ObjectPageSection>

			<ux:ObjectPageSection titleUppercase="false" title="{i18n>email.tabs.label.responsePreparation}">
				<ux:subSections>
					<ux:ObjectPageSubSection title="{i18n>email.tabs.label.responsePreparation}">
						<VBox class="sapUiTinyMargin">
							<Title text="{i18n>email.title.additionalInfo}:"/>
							<TextArea width="100%" growing="true" valueLiveUpdate="true" placeholder="{i18n>email.placeholder.additionalInfo}" value="{/additionalInfo}"/>
							<HBox justifyContent="End">
								<Button type="Emphasized" text="{i18n>email.label.generateButton}" press="onPressGenerate"/>
							</HBox>
						</VBox>
					</ux:ObjectPageSubSection>
				</ux:subSections>
			</ux:ObjectPageSection>

			<ux:ObjectPageSection titleUppercase="false" title="{i18n>email.tabs.label.suggestedResponse}">
				<ux:subSections>
					<ux:ObjectPageSubSection title="{i18n>email.tabs.label.suggestedResponse}">
						<VBox class="sapUiTinyMargin">
							<TextArea
								width="100%"
								growing="true"
								valueLiveUpdate="true"
								value="{/potentialResponse}"
								showValueStateMessage="false"
								valueState="{= ${/potentialResponse} !== ${api>mail/potentialResponse} ? 'Warning' : 'None' }"
								liveChange="onChangeResponse"/>
							<HBox justifyContent="End">
								<Button type="Emphasized" text="{i18n>email.label.submitButton}" press="onPressSubmit"/>
							</HBox>
						</VBox>
					</ux:ObjectPageSubSection>
				</ux:subSections>
			</ux:ObjectPageSection>

			<ux:ObjectPageSection titleUppercase="false" title="{i18n>email.tabs.label.similarEmails} ({/similarEmails/length})">
				<ux:subSections>
					<ux:ObjectPageSubSection title="{i18n>email.tabs.label.similarEmails} ({/similarEmails/length})">
						<VBox class="sapUiTinyMargin">
							<List
                                id="similarEmailsList"
								showSeparators="None"
                                mode="SingleSelectMaster"
                                noDataText="{i18n>email.list.label.noData}"
                                items="{
									path: '/similarEmails',
									sorter: {path: 'similarity', descending: 'false'}
								}">
                                <CustomListItem>
									<Panel
										expandable="true"
										expanded="false"
										stickyHeader="true"
										headerText="{mail/subject} | {i18n>email.list.label.similarity}: {path:'similarity', formatter:'formatter.getFormattedSimilarity'}%">
                  						<content>
                                    		<core:Fragment fragmentName="aisaas.ui.view.SimilarEmailListItem" type="XML"/>
										</content>
									</Panel>
                                </CustomListItem>
                            </List>
						</VBox>
					</ux:ObjectPageSubSection>
				</ux:subSections>
			</ux:ObjectPageSection>
		</ux:sections>
	</ux:ObjectPageLayout>

	<FlexBox height="100%" alignItems="Center" justifyContent="Center" visible="{= !${/activeEmailId} }">
		<Label text="{i18n>email.label.noEmail}"/>
	</FlexBox>
	
</mvc:View>