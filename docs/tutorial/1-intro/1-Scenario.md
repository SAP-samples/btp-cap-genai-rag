# Scenario

This part of the tutorial offers a comprehensive overview of the scenario addressed in this step-by-step guide, along with key technical highlights of our sample scenario.

## Introduction

The provided code samples showcase a **GenAI Mail Insights** sample scenario designed for the SAP Business Technology Platform (SAP BTP). It has been created by a potential SAP partner or customer and is specifically designed to enhance customer support within a travel agency through the use of advanced email analysis and automation.

In this scenario, the application employs **Large Language Models (LLMs)** to examine incoming emails, providing **key insights** such as **categorization**, **sentiment analysis**, and **urgency** assessment. Additionally, it offers more advanced features, including the extraction of essential information such as the **location** or **traveler type**.

One particularly innovative aspect is the use of **embeddings** to identify historical emails that are similar to the current ones, helping to understand how similar requests were handled in the past. This promotes consistent and efficient customer service. The code also demonstrates the ability to **summarize** and **translate** both the subject and body of emails, making it easier to understand and work with content in different languages.

Moreover, the application takes automation to the next level by **generating potential responses** to customer inquiries. This response generation process is influenced by **configurable actions and services**, leading to improved response accuracy and speed. Additionally, the system can seamlessly **integrate with SAP systems** like **SAP Concur**, adding an enterprise dimension and facilitating the integration of processes and data.

While initially designed for a travel agency, this code can be adapted to suit various industries, making it a versatile solution for enhancing customer support with data-driven insights and automation.

## Application Concept

1. New mails are added to the GenAI Mail Insights Application either using the API endpoint or the in-app **Add Mail** feature.

   - The API endpoint allows the processing of multiple mails in parallel
   - The in-app feature only allows users to add one mail at a time.

     [<img src="./images/FL_PushAPI.png" height="150"/>](./images/FL_PushAPI.png?raw=true)
     [<img src="./images/FL_InAppAdd.png" height="150"/>](./images/FL_InAppAdd.png?raw=true)

2. The mails are being pre-processed using the capabilities of a Large Language Model (1-6):

   - Insights such as the urgency, a mail summary, the tone, key facts as well as potential actions are being extracted
   - A preliminary response is being generated in the original mail language and the user's working language
   - The features of zod (https://github.com/colinhacks/zod) are used to simplify the structured prompt response (6)
   - An embedding vector is created from the incoming mail, which can be used for similarity search (7)
   - Embeddings and insights are stored in a SAP HANA Cloud Database leveraging the built-in Vector Engine
   - The results of the processing process are returned back to the user or API caller (8)

     [<img src="./images/FL_AddMail01.png" height="150"/>](./images/FL_AddMail01.png?raw=true)
     [<img src="./images/FL_AddMail02.png" height="150"/>](./images/FL_AddMail02.png?raw=true)

     [<img src="./images/FL_AddMail03.png" height="150"/>](./images/FL_AddMail03.png?raw=true)
     [<img src="./images/FL_AddMail04.png" height="150"/>](./images/FL_AddMail04.png?raw=true)

     [<img src="./images/FL_AddMail05.png" height="150"/>](./images/FL_AddMail05.png?raw=true)
     [<img src="./images/FL_AddMail07.png" height="150"/>](./images/FL_AddMail07.png?raw=true)

3. The user can now review the latest mails in the UI using the following features (1-8):

   - Filtering and sorting the mails by various criteria such as urgency or created at date
   - Switching from "working language" to the original language of the mail
   - Checking the summaries or even the whole e-mail content
   - Validating potential actions after checking the extracted details
   - Reviewing similar mail enquiries listed for each processed mail

     [<img src="./images/FL_App01.png" height="150"/>](./images/FL_App01.png?raw=true)
     [<img src="./images/FL_App02.png" height="150"/>](./images/FL_App02.png?raw=true)

     [<img src="./images/FL_App03.png" height="150"/>](./images/FL_App03.png?raw=true)
     [<img src="./images/FL_App04.png" height="150"/>](./images/FL_App04.png?raw=true)

     [<img src="./images/FL_App05.png" height="150"/>](./images/FL_App05.png?raw=true)

4. Once the user has understood the customer's problem, the answer can be finalized (1-4):

   - The user can accept the auto-generated initial answer generated by the LLM
   - Alternatively, the user can re-generate an answer by adding additional context
   - If similar enquiries exist, the user can leverage them to auto-generate a new response

     [<img src="./images/FL_App06.png" height="150"/>](./images/FL_App06.png?raw=true)
     [<img src="./images/FL_App07.png" height="150"/>](./images/FL_App07.png?raw=true)

     [<img src="./images/FL_App08.png" height="150"/>](./images/FL_App08.png?raw=true)
     [<img src="./images/FL_App09.png" height="150"/>](./images/FL_App09.png?raw=true)

5. Being satisfied with a potential response, the user can submit the response to the customer

   - This will - if necessary - translate the response into the original mail language using LLM capabilities
   - The user will see the final response sent to the customer in a popup incl. a translation
   - The answer will be stored in the backend together with the translated response
   - For future mails, the answer can be considered for similarity search to create new responses

     [<img src="./images/FL_Answer01.png" height="150"/>](./images/FL_Answer01.png?raw=true)
     [<img src="./images/FL_Answer02.png" height="150"/>](./images/FL_Answer02.png?raw=true)
     [<img src="./images/FL_Answer04.png" height="150"/>](./images/FL_Answer04.png?raw=true)

## Technical Highlights

The GenAI Mail Insights sample scenario uniquely leverages SAP BTP's Generative AI capabilities, utilizing SAP HANA Cloud as a vector store for optimized data retrieval and similarity matching. Through integration with Large Language Models (LLMs) via the Generative AI Hub, this solution enables functionality across both single-tenant and multitenant environments. Distinct from standard SAPUI5 applications, it showcases how SAP BTP applications can fully harness Generative AI for advanced, adaptable insights.

### SAP HANA Cloud's Vector Engine

The [Vector Engine](https://help.sap.com/docs/hana-cloud-database/sap-hana-cloud-sap-hana-database-vector-engine-guide/sap-hana-cloud-sap-hana-database-vector-engine-guide) in [SAP HANA Cloud](https://discovery-center.cloud.sap/serviceCatalog/sap-hana-cloud?region=all) manages unstructured data, such as text and images, in high-dimensional embeddings, enhancing AI models with long-term memory and better context. These features enable Retrieval Augmented Generation (RAG), combining LLMs with private business data to create intelligent applications that support automated decision-making and boost developer productivity.

Some key benefits and features of the Vector Engine include:

- Multi-model: Users can unify all types of data into a single database to build innovative applications using an efficient data architecture and in-memory performance. By adding vector storage and processing to the same database already storing relational, graph, spatial, and even JSON data, application developers can create next-generation solutions that interact more naturally with the user.
- Enhanced search and analysis: Businesses can now apply semantic and similarity search to business processes using documents like contracts, design specifications, and even service call notes.
- Personalized recommendations: Users can benefit from an improved overall experience with more accurate and personalized suggestions.
- Optimized large language models: The output of LLMs is augmented with more effective and contextual data.

### SAP AI Core

[SAP AI Core](https://discovery-center.cloud.sap/serviceCatalog/sap-ai-core?region=all) is a service in the SAP Business Technology Platform that is designed to handle the execution and operations of your AI assets in a standardized, scalable, and hyperscaler-agnostic way. It provides seamless integration with your SAP solutions. Any AI function can be easily realized using open-source frameworks. SAP AI Core supports full lifecycle management of AI scenarios.

### Generative AI Hub

The [Generative AI Hub](https://help.sap.com/docs/sap-ai-core/sap-ai-core-service-guide/generative-ai-hub-in-sap-ai-core) incorporates Generative AI into your AI activities in [SAP AI Core](https://discovery-center.cloud.sap/serviceCatalog/sap-ai-core?region=all) and [SAP AI Launchpad](https://discovery-center.cloud.sap/serviceCatalog/sap-ai-launchpad?region=all).

To achieve this, the Generative AI Hub offers secure and reliable access to Foundation Models, primarily Large Language Models (LLMs), hosted on SAP BTP or by external partners such as Microsoft Azure, Google, and AWS, but also simplifies their integration into business processes. These models can be used for different domain-specific applications, utilizing patterns like Retrieval Augmented Generation (RAG), AI Agents, or Conversational AI, all accessed via standardized APIs to streamline the implementation of Generative AI.

Please note that, as of the present, there is no free tier offering available for the generative AI hub service plan, and charges are incurred based on the tokens consumed.
